@model Eonup.EF.Model.Category
@{
    ViewBag.Title = "搜索页";
    IEnumerable<SelectListItem> categories1 = ViewBag.FirstList as IEnumerable<SelectListItem>;
    IEnumerable<SelectListItem> categories2 = ViewBag.SecondList as IEnumerable<SelectListItem>;
    IEnumerable<SelectListItem> categories3 = ViewBag.ThirdList as IEnumerable<SelectListItem>;
}

<h2>@ViewBag.Title</h2>


@using (Html.BeginForm())
{
    <p>
        @Html.Label("Title", "Find by Title:")
        @Html.TextBox("search", ViewBag.Searching as string, new { @class = "form-  control", @style = "display:inline;" })
        @Html.DropDownList("firstDrop", categories1)
        @Html.DropDownList("secondDrop", categories2)
        @Html.DropDownList("thirdDrop", categories3)
        @Html.Button("查询")
    </p>
    <div id="searchPartialList">
        @Html.Action("SearchPartialList",new { searchString= "男装",pageIndex=1,orderby=-1 })
    </div>
}
@section scripts{
    <script>
        $(function () {
            var UnSelect = "<option value='-1'>--请选择--</option>";
            $("#firstDrop").on("change", function () {
                var id = $("#firstDrop").val();
                if ($(this).val() == -1) {
                    $("#secondDrop option").remove();
                    $("#secondDrop").append(UnSelect);
                    $("#thirdDrop option").remove();
                    $("#thirdDrop").append(UnSelect);
                }
                else {
                    $.ajax({
                        url: "/Fifth/CategoryDropBind",
                        data: { id: id },
                        dataType: "json",
                        type: "post",
                        success: function (data) {
                            $("#secondDrop option").remove();
                            $("#secondDrop").append(UnSelect);
                            var rs = data.data;
                            for (var i = 0; i < rs.length; i++) {
                                $("#secondDrop").append("<option value='" + rs[i].Value + "'>" + rs[i].Text + "</option>");
                            }
                            $("#secondDrop").val(-1);
                            $("#thirdDrop option").remove();
                            $("#thirdDrop").append(UnSelect);
                        },
                        error: function () {
                            alert("错误搜索，请联系管理员！");
                        }
                    });

                }
            })
            $("#secondDrop").on("change", function () {
                if ($(this).val() == -1) {
                    $("#thirdDrop option").remove();
                    $("#thirdDrop").append(UnSelect);
                }
                else {
                    $.ajax({
                        url: "/Fifth/CategoryDropBind",
                        data: { id: $(this).val() },
                        dataType: "json",
                        type: "post",
                        success: function (data) {
                            $("#thirdDrop option").remove();
                            $("#thirdDrop").append(UnSelect);
                            var rs = data.data;
                            for (var i = 0; i < rs.length; i++) {
                                $("#thirdDrop").append("<option value='" + rs[i].Value + "'>" + rs[i].Text + "</option>");
                            }
                        },
                        error: function (data) { alert("请求失败，请联系管理员！"); }
                    });
                }
            })

        })
    </script>
    }